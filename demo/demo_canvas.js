(()=>{"use strict";class e{}class t{constructor(t){this.canvas=t,this.isDrawing=!1,this.onStroke=e=>{const t=this.points.get(e.pointerId);if(null==t)return;this.updateStrokeStyle();const o=this.canvas.getContext("2d");o.beginPath(),o.moveTo(t.x,t.y),o.lineTo(e.offsetX,e.offsetY),o.closePath(),o.stroke(),this.points.set(e.pointerId,new n(e.offsetX,e.offsetY))},this.onStartStroke=e=>{this.points.set(e.pointerId,new n(e.offsetX,e.offsetY))},this.onFinishStroke=e=>{this.points.delete(e.pointerId)},this.option=new e,this.points=new Map,this.clear()}clear(){const e=this.canvas.getContext("2d");e.clearRect(0,0,this.canvas.width,this.canvas.height),this.points.clear(),e.beginPath()}startDrawing(e){this.changeMode(e),this.isDrawing||(this.isDrawing=!0,this.canvas.addEventListener("pointerdown",this.onStartStroke),this.canvas.addEventListener("pointermove",this.onStroke),this.canvas.addEventListener("pointerup",this.onFinishStroke))}finishDrawing(){this.isDrawing&&(this.isDrawing=!1,this.canvas.removeEventListener("pointerdown",this.onStartStroke),this.canvas.removeEventListener("pointermove",this.onStroke),this.canvas.removeEventListener("pointerup",this.onFinishStroke))}changeMode(e){const t=this.canvas.getContext("2d");this.option.mode=e.mode,this.option.color=e.color??t.strokeStyle,this.option.width=e.width??t.lineWidth,this.updateStrokeStyle()}updateStrokeStyle(){const e=this.canvas.getContext("2d");switch(this.option.mode){case"pen":e.globalCompositeOperation="source-over";break;case"eraser":e.globalCompositeOperation="destination-out"}e.strokeStyle=this.option.color,e.lineWidth=this.option.width,e.lineCap="round",e.lineJoin="round"}restoreImage(e,t="no-cors"){const n=new Request(e,{method:"GET",mode:t});return fetch(n).then((e=>{if(!e.ok)throw new Error("Error : Network response was not ok.");return e.blob()})).then((e=>this.drawImage(e)))}isImageType(e){switch(e.type){case"image/jpeg":case"image/png":return!0}return!1}drawImage(e){return new Promise(((t,n)=>{this.isImageType(e)||t();const o=new Image,i=this.canvas.getContext("2d");this.clear(),o.onload=()=>{i.drawImage(o,0,0),t()},o.onerror=()=>{n()},o.src=URL.createObjectURL(e)}))}}class n{constructor(e=0,t=0){this.x=e,this.y=t}}let o;const i='input[name="mode"]',a='input[name="color"]',s='input[name="width"]',r=()=>{document.body.innerHTML='\n  <canvas id="appCanvas" width="640" height="480"></canvas>\n    <p>\n      mode:\n      <label><input type="radio" name="mode" value="pen" checked />pen</label>\n      <label><input type="radio" name="mode" value="eraser" />eraser</label>\n    </p>\n    <p>\n        color:\n        <label><input type="color" name="color" value="#ff00ff" /></label>\n    </p>\n    <p>\n        width:\n        <label><input type="number" name="width" min="1" max="20" value="8" /></label>\n    </p>\n    <p>\n        <input type="button" name="clearButton" value="Clear"/>\n    </p>',c();const e=document.getElementById("appCanvas");o=new t(e),h(),o.restoreImage("./img01.png")},c=()=>{document.querySelectorAll(i).forEach((e=>{e.onchange=e=>{o.startDrawing({mode:e.target.value})}})),document.querySelector(a).onchange=e=>{o.startDrawing({color:e.target.value})},document.querySelector(s).onchange=e=>{o.startDrawing({width:e.target.value})},document.querySelector('input[name="clearButton"]').onclick=e=>{o.clear()}},h=()=>{const e=document.querySelector(i+":checked").value,t=document.querySelector(a).value,n=document.querySelector(s).value;o.startDrawing({mode:e,color:t,width:n})};"loading"!==document.readyState?r():document.addEventListener("DOMContentLoaded",r)})();